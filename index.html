<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>MailCleaner - Gestore Avanzato</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="header">
        <div class="header-left">
            <button id="sidebar-toggle" class="btn-hamburger" onclick="toggleSidebar()" aria-label="Apri cartelle">
                â˜°
            </button>
            <div>
                <h1>MailCleaner ğŸ§¹</h1>
                <p>Gestisci, raggruppa, leggi e svuota le tue cartelle.</p>
            </div>
        </div>
        <div class="header-actions">
            <div id="search-container" class="hidden">
                <input type="text" id="search-input" placeholder="Cerca..." oninput="handleDynamicSearch()" onkeypress="handleSearch(event)">
                <button id="search-btn" onclick="executeSearch()" title="Cerca">ğŸ”</button>
            </div>
            
            <button id="signout_button" class="hidden" onclick="handleSignoutClick()">Esci</button>
        </div>
    </div>

    <hr>

    <div id="app-container" class="hidden">
        
        <div id="sidebar-overlay" onclick="closeSidebar()"></div>

        <aside id="sidebar">
            <button class="btn-close-sidebar" onclick="closeSidebar()" aria-label="Chiudi">âœ•</button>

            <div class="sidebar-header">
                <h3>ğŸ“‚ Cartelle</h3>
                <button onclick="loadLabels()" class="btn-refresh">ğŸ”„</button>
            </div>
            <ul id="label_list">
                <li><small>Caricamento...</small></li>
            </ul>

            <div id="drawer-container" class="hidden">
                <div class="sidebar-header" style="margin-top: 20px;">
                    <h3>ğŸ—„ï¸ Fascicoli Aperti</h3>
                    <button onclick="clearDrawer()" class="btn-refresh">âŒ</button>
                </div>
                <div id="drawer-stack"></div>
            </div>
        </aside>

        <main id="main-content">
            <div class="toolbar" id="main-toolbar" style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                <h2 id="view-title" style="margin: 0; font-size: 18px; color: #007bff;">ğŸ“¥ Inbox</h2>
                <button onclick="listEmails()">ğŸ“¨ Torna alla Inbox</button>
            </div>
            
            <div id="email_list"></div>

            <div id="single-email-view" class="hidden">
                <button onclick="closeEmail()" class="btn-back">â¬…ï¸ Chiudi Email</button>
                <div id="single-email-content"></div>
            </div>
        </main>

        <!-- â•â•â• PANNELLO SCANSIONE DESTRA â•â•â• -->
        <aside id="scan-panel" class="hidden">
          <div class="sp-header">
            <div class="sp-header-left">
              <span class="sp-icon">ğŸ“¡</span>
              <div>
                <div class="sp-title">Scansione Inbox</div>
                <div id="sp-stats" class="sp-subtitle">â€”</div>
              </div>
            </div>
            <button id="sp-toggle-btn" class="sp-toggle" onclick="toggleScanPanel()" title="Chiudi pannello">âœ•</button>
          </div>

          <div id="sp-progress-wrap">
            <div id="sp-progress-track">
              <div id="sp-fill"></div>
            </div>
            <div id="sp-progress-text">Caricamento...</div>
          </div>

          <div id="sp-list"></div>
        </aside>

    </div>

    <div id="custom-menu">
        <div id="menu-handle"></div><button id="menu-open">ğŸ“– Apri questa email</button>
        <button id="menu-delete">ğŸ—‘ï¸ Cancella questa email</button>
        <button id="menu-group">ğŸ“ Raggruppa per mittente</button>
        <button id="menu-group-selected">ğŸ—‚ï¸ Raggruppa selezionate</button>
        <button id="menu-cancel" class="btn-menu-cancel">Annulla</button>
    </div>
    <div id="menu-overlay" onclick="closeContextMenu()"></div>

    <button id="authorize_button" onclick="handleAuthClick()" class="btn-auth-fixed disabled" disabled>
        <span class="btn-auth-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="22" height="22">
                <path fill="#EA4335" d="M24 9.5c3.14 0 5.95 1.08 8.17 2.86l6.1-6.1C34.46 3.11 29.5 1 24 1 14.82 1 7.07 6.48 3.64 14.22l7.1 5.52C12.4 13.67 17.73 9.5 24 9.5z"/>
                <path fill="#4285F4" d="M46.5 24.5c0-1.64-.15-3.22-.42-4.75H24v9h12.7c-.55 2.97-2.2 5.48-4.67 7.17l7.18 5.58C43.34 37.04 46.5 31.22 46.5 24.5z"/>
                <path fill="#FBBC05" d="M10.74 28.26A14.55 14.55 0 0 1 9.5 24c0-1.48.25-2.91.69-4.26l-7.1-5.52A23.93 23.93 0 0 0 0 24c0 3.86.92 7.5 2.55 10.72l8.19-6.46z"/>
                <path fill="#34A853" d="M24 47c5.5 0 10.12-1.82 13.5-4.95l-7.18-5.58C28.54 37.92 26.4 38.5 24 38.5c-6.27 0-11.6-4.17-13.26-9.74l-8.19 6.46C6.07 43.52 14.44 47 24 47z"/>
            </svg>
        </span>
        <span class="btn-auth-label" id="auth_button_text">â³ Caricamento...</span>
    </button>

    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
    <script src="app.js"></script>
</body>
</html>
